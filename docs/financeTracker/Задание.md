## Видение и роли компонентов

- **Продукт**: личный финансовый трекер c полуавтоматическим импортом чеков через OCR, анализ расходов и подсказки.
- **Пользовательский поток**: регистрация/вход → добавление кошельков/категорий → загрузка фото/пдф чека → распознавание → ручная валидация → аналитика и отчёты.
- **Ключевые участки системы**
    - UI на `Svelte` + `TypeScript`.
    - Клиентское состояние: локальная база (IndexedDB/Dexie) или внешний BaaS/собственный backend.
    - OCR: локальный движок (Tesseract.js) или сторонний API (Google Vision, Mindee и т.п.).
    - Импорт/экспорт: CSV/Excel, возможно Telegram/Email-бот.
    - Уведомления и цели бюджета.

### Мини-контракт доменной модели

- `User` → профайл и настройки (валюта, язык, категории по умолчанию).
- `Account` → кошелёк/карта (баланс, тип, валюта).
- `Receipt` → источник (ocr/raw), файлы, время, поставщик.
- `LineItem` → связанные категории, сумма, налог, скидка.
- `BudgetRule` → месячные лимиты/цели.
- `Transaction` → итоговая запись в журнале (может ссылаться на `receiptId`). Edge cases, которые стоит держать в голове:

1. Неудачное распознавание (пустой текст, дубли, неправильная валюта).
2. Большие чеки (20+ позиций) и производительность на слабом устройстве.
3. Конфликт валют при расчёте бюджета.
4. Асинхронные ошибки сети при работе с внешним OCR.
5. Конфиденциальность: безопасное хранение изображений и персональных данных.

## Этапы разработки (дорожная карта)

1. **Подготовка среды**
    - Настроить линтер/форматтер (ESLint + Prettier) и `svelte-check`.
    - Добавить базовые ui-компоненты (layout, цветовая тема).
    - Настроить глобальный стор (Svelte store + TypeScript типы).

2. **Базовая функциональность бюджета (MVP)**
    - Реализовать ввод расходов вручную: форма, категории, списки.
    - Хранение данных: начать с IndexedDB (через Dexie) + синхронизация с localStorage (резерв).
    - Диаграммы: подключить `svelte-apexcharts` или `chart.js` для круговой/линейной диаграммы.

3. **OCR-пайплайн**
    - Выбор подхода:
        - **Локально**: Tesseract.js (без передачи данных, но медленнее).
        - **Сервис**: например, Mindee (API-ключ, расходы).
    - Создать сервис-абстракцию `ReceiptParser` с интерфейсом: `parse(file): Promise<OCRResult>`.
    - Обработка результата: маппинг в `LineItem[]`, отображение UI для ручной валидации.

4. **Улучшения UX и аналитика**
    - Мастер добавления чека: drag-and-drop, предпросмотр.
    - Автокатегоризация (простая ML/правила).
    - Фильтры/сегментация, отчёты по периодам, экспорт.

5. **Интеграции и безопасность**
    - Авторизация (Supabase/Auth0/Firebase).
    - Синхронизация между устройствами.
    - Шифрование локальной базы, политика хранения изображений.

6. **Производство и поддержка**
    - CI (GitHub Actions) с `pnpm install`, `pnpm check`, `pnpm test`, `pnpm build`.
    - Документация (Storybook для компонентов, README по API).
    - Логирование и мониторинг (Sentry).

## Первые практические шаги (мини-спринт на 1–2 недели)

1. **Спринт 0 — фундамент**
    - Настроить Prettier + ESLint (typescript-svelte).
    - Добавить базовую навигацию и layout (`Header`, `Sidebar`, `Main`).
    - Создать типы `Account`, `Transaction`, `Category`; потренироваться с `Readonly`, `Pick`, `Record`.

2. **Спринт 1 — ручной ввод расходов**
    - Форма добавления транзакции (Svelte form + валидация `zod`).
    - Список последних расходов (виртуальный список, сортировка).
    - Локальное хранилище через Svelte store + persist (Dexie или `localStorage`).
    - Юнит-тесты вычислений бюджета (Vitest + TS generics).

3. **Спринт 2 — прототип OCR**
    - Страница загрузки файла: drag&drop, предпросмотр.
    - Интеграция с Tesseract.js (установка, базовый парсинг).
    - Обработка результата: парсинг текста в `LineItem[]`, модалка для редактирования.
    - Обработка ошибок и индикатор прогресса.

4. **Спринт 3 — аналитика**
    - Простая диаграмма расходов по категориям.

- Настройка фильтров (дата, категория).
- Мемоизация вычислений (derived stores, `Readable`/`Writable`).

### Практика TS/Svelte по пути

- Писать каждую сущность строго типизированной: `type CategoryId = Brand<string, "CategoryId">`.
- Использовать Svelte store с `interface` для state machine.
- Применять асинхронные экшены (`createEventDispatcher`, `onMount`, `async` lifecycle).
- Добавить `Vitest` + `@testing-library/svelte` для UI-тестов (happy path + ошибка OCR).

## Ресурсы и подсказки

- **Svelte**: официальные tutorial + Svelte Society.
- **TypeScript**: TypeScript Deep Dive, учебный репо `Type Challenges`.
- **OCR**: документация Tesseract.js, бесплатные API Mindee/Google Vision (с квотой).
- **Финансы**: UX-референсы (YNAB, Money Lover) — посмотреть потоки пользователей.

## Качество и проверки

- Проверки не запускались — изменений в коде нет.
- Следите за `pnpm install`, `pnpm dev`, `pnpm check` как стандартным циклом.

## Requirements coverage

- План проекта: **Готово** (дорожная карта с этапами).
- Обозначение шагов разработки: **Готово** (спринты и задачи).
- Рекомендации для прокачки TS/Svelte: **Готово**.
